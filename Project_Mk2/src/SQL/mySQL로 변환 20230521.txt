-- 대분류 카테고리 테이블
CREATE TABLE CATEGORY (
    CAT_NO INT(5) NOT NULL,
    CAT_NAME VARCHAR(100) NOT NULL,
    PRIMARY KEY (CAT_NO)
);

-- 기본정보 테이블
CREATE TABLE BASIC_DATA (
    BAS_NO VARCHAR(10) NOT NULL,
    CAT_NO INT(5) NOT NULL,
    BAS_NAME VARCHAR(200) NOT NULL,
    BAS_ADDR VARCHAR(200) NOT NULL,
    BAS_LAT VARCHAR(20) NOT NULL,
    BAS_LNG VARCHAR(20) NOT NULL,
    PRIMARY KEY (BAS_NO)
);

-- 상세정보 테이블
CREATE TABLE REST_DATA (
    REST_NO INT(5) NOT NULL,
    BAS_NO VARCHAR(10) NOT NULL,
    REST_OPENTIME VARCHAR(20) NULL,
    REST_LOCK VARCHAR(5) NOT NULL,
    REST_TOI INT(5) NULL,
    REST_URI INT(5) NULL,
    REST_DIS_TOL INT(5) NULL,
    REST_DIS_URI INT(5) NULL,
    REST_CL_TIME VARCHAR(20) NULL,
    REST_STATUS VARCHAR(5) NULL,
    REST_KEY VARCHAR(2) DEFAULT 'Y',
    PRIMARY KEY (REST_NO)
);

-- 리뷰 테이블
CREATE TABLE REVIEW (
    RE_NO INT(5) NOT NULL,
    BAS_NO VARCHAR(10) NOT NULL,
    RE_SCO INT(2) NULL,
    RE_CONTENT VARCHAR(1000) NOT NULL,
    RE_REG_DATE DATETIME DEFAULT CURRENT_TIMESTAMP,
    PRIMARY KEY (RE_NO)
);

-- 멤버(관리자) 테이블
CREATE TABLE MEMBER (
    MEM_NO INT(5) NOT NULL,
    MEM_ID VARCHAR(30) NOT NULL,
    MEM_PASS VARCHAR(30) NOT NULL,
    MEM_KEY VARCHAR(2) DEFAULT 'U',
    PRIMARY KEY (MEM_NO)
);

-- 건의사항 테이블
CREATE TABLE SUG_BOARD (
    SUG_NO INT(5) NOT NULL,
    SUG_SUBJECT VARCHAR(100) NOT NULL,
    SUG_CONTENT TEXT NOT NULL,
    SUG_REG_DATE DATETIME DEFAULT CURRENT_TIMESTAMP,
    SUG_READ_CK VARCHAR(1),
    PRIMARY KEY (SUG_NO)
);

-- 시퀀스 생성
CREATE SEQUENCE CATEGORY_SEQ;
CREATE SEQUENCE BASIC_DATA_SEQ;
CREATE SEQUENCE REST_DATA_SEQ;
CREATE SEQUENCE REVIEW_SEQ;
CREATE SEQUENCE MEMBER_SEQ;
CREATE SEQUENCE SUG_SEQ;

-- 어드민 계정 생성
INSERT INTO MEMBER (MEM_NO, MEM_ID, MEM_PASS, MEM_KEY) VALUES (MEMBER_SEQ.NEXTVAL, 'admin', 'admin1', 'A');

-- 테이블 수정
ALTER TABLE BASIC_DATA CHANGE COLUMN BAS_NO BAS_NO VARCHAR(10) NOT NULL;
ALTER TABLE BASIC_DATA CHANGE COLUMN BAS_NAME BAS_NAME VARCHAR(200) NOT NULL;
ALTER TABLE BASIC_DATA CHANGE COLUMN BAS_LNG BAS_LNG VARCHAR(20) NOT NULL;
ALTER TABLE REST_DATA CHANGE COLUMN BAS_NO BAS_NO VARCHAR(10) NOT NULL;
ALTER TABLE REST_DATA CHANGE COLUMN REST_OPENTIME REST_OPENTIME VARCHAR(20) NULL;
ALTER TABLE REST_DATA CHANGE COLUMN REST_CL_TIME REST_CL_TIME VARCHAR(20) NULL;
ALTER TABLE REVIEW CHANGE COLUMN BAS_NO BAS_NO VARCHAR(10) NOT NULL;

-- 데이터 삭제
DELETE FROM BASIC_DATA;
DELETE FROM REST_DATA;
DELETE FROM REVIEW;

-- 시퀀스 재생성
ALTER TABLE BASIC_DATA_SEQ RESTART WITH 1;
ALTER TABLE REST_DATA_SEQ RESTART WITH 1;
ALTER TABLE REVIEW_SEQ RESTART WITH 1;

-- 사용자 계정 생성
CREATE USER 'dowajo1234'@'localhost' IDENTIFIED BY 'dowajo1234';
GRANT ALL PRIVILEGES ON *.* TO 'dowajo1234'@'localhost';

-- root-context.xml 수정
<!-- MySQL 데이터베이스 설정 -->
<bean id="dataSource" class="org.springframework.jdbc.datasource.DriverManagerDataSource">
    <property name="driverClassName" value="com.mysql.jdbc.Driver" />
    <property name="url" value="jdbc:mysql://localhost:3306/{database_name}" />
    <property name="username" value="dowajo1234" />
    <property name="password" value="dowajo1234" />
</bean>

-- 건의사항 테이블 수정
CREATE TABLE SUG_BOARD (
    SUG_NO INT(5) NOT NULL,
    SUG_SUBJECT VARCHAR(100) NOT NULL,
    SUG_CONTENT TEXT NOT NULL,
    SUG_REG_DATE DATETIME DEFAULT CURRENT_TIMESTAMP,
    PRIMARY KEY (SUG_NO)
);

ALTER TABLE SUG_BOARD ADD COLUMN SUG_READ_CK VARCHAR(1);
ALTER TABLE SUG_BOARD MODIFY COLUMN SUG_CONTENT NVARCHAR(2000);

-- WIFI DATA 테이블 생성
CREATE TABLE WIFI_DATA(
    WIFI_NO INT(5) NOT NULL,
    BAS_NO VARCHAR(10) NOT NULL,
    WIFI_NAME VARCHAR(20) NOT NULL,
    WIFI_PW VARCHAR(20),
    PRIMARY KEY (WIFI_NO)
);

-- WIFI DATA 테이블 용 시퀀스 생성
CREATE SEQUENCE WIFI_SEQ;

-- 데이터 삭제 및 시퀀스 재생성
DELETE FROM BASIC_DATA;
DELETE FROM REST_DATA;
DELETE FROM REVIEW;

ALTER TABLE BASIC_DATA_SEQ RESTART WITH 1;
ALTER TABLE REST_DATA_SEQ RESTART WITH 1;
ALTER TABLE REVIEW_SEQ RESTART WITH 1;

CREATE SEQUENCE CATEGORY_SEQ;
CREATE SEQUENCE BASIC_DATA_SEQ;
CREATE SEQUENCE REST_DATA_SEQ;
CREATE SEQUENCE REVIEW_SEQ;
CREATE SEQUENCE MEMBER_SEQ;
CREATE SEQUENCE SUG_SEQ;

-- 멤버 테이블 수정
DROP TABLE MEMBER;

CREATE TABLE MEMBER (
    MEM_NO INT(5) NOT NULL,
    MEM_ID VARCHAR(30) NOT NULL,
    MEM_PASS VARCHAR(30) NOT NULL,
    MEM_NICKNAME VARCHAR(30) NOT NULL,
    MEM_KEY VARCHAR(1) DEFAULT 'U',
    PRIMARY KEY (MEM_NO)
);

-- 관리자 및 기본 유저 아이디 저장
INSERT INTO MEMBER (MEM_NO, MEM_ID, MEM_PASS, MEM_NICKNAME, MEM_KEY) VALUES (1, 'admin', '1234', 'admin', 'A');
INSERT INTO MEMBER (MEM_NO, MEM_ID, MEM_PASS, MEM_NICKNAME, MEM_KEY) VALUES (2, 'user1', '1234', 'userA', 'U');

-- 시퀀스 재생성
ALTER TABLE MEMBER_SEQ RESTART WITH 3;

COMMIT;